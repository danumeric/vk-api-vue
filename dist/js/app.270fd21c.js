(function(){"use strict";var e={8722:function(e,t,r){var s=r(9242),n=r(3396);function i(e,t){const r=(0,n.up)("router-view");return(0,n.wg)(),(0,n.j4)(r)}var o=r(89);const d={},a=(0,o.Z)(d,[["render",i]]);var c=a,u=r(678);const l={class:"home"},f={class:"targeted-container"},h={class:"targeted-container__central"},p={key:1,class:"targeted-container__plug"};function m(e,t,r,s,i,o){const d=(0,n.up)("ListChoosedUsers"),a=(0,n.up)("FormAddUser"),c=(0,n.up)("FriendsList"),u=(0,n.up)("ListSearchedUser");return(0,n.wg)(),(0,n.iD)("div",l,[(0,n._)("div",f,[(0,n.Wm)(d,{class:"targeted-container__choosed"}),(0,n._)("div",h,[(0,n.Wm)(a,{class:"targeted-container__form"}),(0,n.Wm)(c)]),this.isSearchedResults?((0,n.wg)(),(0,n.j4)(u,{key:0,class:"targeted-container__search"})):((0,n.wg)(),(0,n.iD)("div",p))])])}const v=e=>((0,n.dD)("data-v-2389eed6"),e=e(),(0,n.Cn)(),e),_={class:"addid"},g={name:"addUser",action:""},U=v((()=>(0,n._)("label",{for:"ids",class:"addid__label"},"Введите id пользователя VK формате id*, либо используйте поиск по имени и фамилии",-1)));function w(e,t,r,i,o,d){return(0,n.wg)(),(0,n.iD)("div",_,[(0,n._)("form",g,[U,(0,n.wy)((0,n._)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>o.idsInput=e),class:"addid__input",type:"text",name:"ids",placeholder:"введите id/имя."},null,512),[[s.nr,o.idsInput]]),(0,n._)("button",{class:"addid__button",onClick:t[1]||(t[1]=(...e)=>d.fillFieldDefauldIds&&d.fillFieldDefauldIds(...e))}," Использовать готовый набор пользователей "),(0,n._)("button",{class:"addid__button",onClick:t[2]||(t[2]=(...e)=>d.createUserList&&d.createUserList(...e)),type:"submit"}," Построить список друзей ")])])}var b=r(65),y={name:"FormAddUser",data(){return{idsInput:"",idsArray:[]}},beforeUpdate(){this.emitSearchText},computed:{...(0,b.Se)(["getPreparedUsers"]),emitSearchText(){return this.fetchSearchedUser(this.idsInput),""}},methods:{...(0,b.nv)(["fetchSearchedUser","fetchFriends"]),async fillFieldDefauldIds(e){e.preventDefault(),await this.fetchSearchedUser("19736017,19076529,9711731,10925651,18157423,224328578")},createUserList(e){e.preventDefault(),this.fetchFriends(this.getPreparedUsers)}}};const F=(0,o.Z)(y,[["render",w],["__scopeId","data-v-2389eed6"]]);var C=F;const k=e=>((0,n.dD)("data-v-310497a2"),e=e(),(0,n.Cn)(),e),D={class:"list"},O=k((()=>(0,n._)("div",{class:"list__header"}," Добавленные пользователи. Кликните для выбора пользователя для дальнейшего построения списка друзей ",-1)));function S(e,t,r,s,i,o){const d=(0,n.up)("UserCard");return(0,n.wg)(),(0,n.iD)("div",D,[O,((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(this.getChoosedUsers,(t=>((0,n.wg)(),(0,n.iD)("div",{class:"list__cards",key:t.id},[(0,n.Wm)(d,{user:t,onClick:r=>e.addUserToPrepared(t),addDeleteButton:!0},null,8,["user","onClick"])])))),128))])}var T=r(6356),B={name:"ListChoosedUser",data(){return{}},components:{UserCard:T.Z},computed:{...(0,b.Se)(["getChoosedUsers"])},methods:{...(0,b.OI)(["addUserToPrepared"])}};const I=(0,o.Z)(B,[["render",S],["__scopeId","data-v-310497a2"]]);var L=I;const j=e=>((0,n.dD)("data-v-772b7090"),e=e(),(0,n.Cn)(),e),A={class:"list"},$=j((()=>(0,n._)("div",{class:"list__header"}," Найденные пользователи. Кликните для добавления в список слева ",-1)));function P(e,t,r,s,i,o){const d=(0,n.up)("UserCard");return(0,n.wg)(),(0,n.iD)("div",A,[$,((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(this.getSearchedUsers,(t=>((0,n.wg)(),(0,n.iD)("div",{class:"list__cards",key:t.id},[(0,n.Wm)(d,{user:t,onClick:r=>e.addUserToChoosed(t),addDeleteButton:!1},null,8,["user","onClick"])])))),128))])}var x={name:"ListSearchedUser",data(){return{}},components:{UserCard:T.Z},computed:{...(0,b.Se)(["getSearchedUsers"])},methods:{...(0,b.OI)(["addUserToChoosed"])}};const E=(0,o.Z)(x,[["render",P],["__scopeId","data-v-772b7090"]]);var Z=E;function W(e,t,r,s,i,o){const d=(0,n.up)("FriendCart");return(0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(this.getFriendsDB,(e=>((0,n.wg)(),(0,n.iD)("div",{class:"friends-list-item",key:e.id},[(0,n.Wm)(d,{friend:e,onClick:t=>o.goToUserInfo(`id=${e.id}&fr_ids=${e.coincidenceFriends.join(",")}`)},null,8,["friend","onClick"])])))),128)}var q=r(7139);const K={class:"friend-card__commoninfo"},z={class:"friend-card__name"},N={class:"friend-card__sex"},H={class:"friend-card__age"},Q={class:"friend-card__friendsinfo"},M={class:"friend-card__fr-count"};function V(e,t,r,s,i,o){return(0,n.wg)(),(0,n.iD)("div",{class:"friend-card",style:(0,q.j5)(i.style)},[(0,n._)("div",K,[(0,n._)("div",z,[(0,n._)("h3",null,(0,q.zw)(r.friend.first_name)+" "+(0,q.zw)(r.friend.last_name),1)]),(0,n._)("div",N," Пол - "+(0,q.zw)(1===r.friend.sex?"Ж":2===r.friend.sex?"М":"Не указан"),1),(0,n._)("div",H,"Возраст - "+(0,q.zw)(o.calculateAge()),1)]),(0,n._)("div",Q,[(0,n._)("div",M,(0,q.zw)(i.counterOfFriends),1)])],4)}const Y=r(4352),R="40482a0e61f412e412e3eec730125d7bb7931bbf9b74b396eb3c78ab7595a628a5c197adac17a8f6d42c8";var G={data(){return{style:"",counterOfFriends:"pending",transparency:.05}},props:{friend:Object},computed:{},methods:{...(0,b.OI)(["pushQueueTimeouts","setKnownCountOfFriends"]),calculateAge(){if(!this.friend.bdate)return"не указана дата рождения";let e=this.friend.bdate.split(".").reverse();if(e.length<3)return"не указан год рождения";const t=Date.parse(e.join("-")),r=new Date;return Math.floor((r-t)/31556952e3)+" лет"},async fetchFriendsCount(){if(this.friend.knownCountOfFriends)return void(this.counterOfFriends=this.friend.knownCountOfFriends+" друзей");let e=setTimeout((async()=>{try{let e=await Y(`https://api.vk.com/method/users.get?user_ids=${this.friend.id}&fields=counters&access_token=${R}&v=5.131`).promise;if(!e.response)return void this.fetchFriendsCount();if("banned"===e.response[0].deactivated)return void(this.counterOfFriends="user banned! ");this.counterOfFriends=e.response[0].counters.friends+" друзей";const t={position:this.friend.positionForLatency,countOfFriends:this.counterOfFriends};this.setKnownCountOfFriends(t)}catch(e){console.log(e)}}),400*+this.friend.positionForLatency);this.pushQueueTimeouts(e)}},async mounted(){this.fetchFriendsCount(),this.friend.coincidenceFriends&&this.friend.coincidenceFriends.length>1&&(this.transparency+=this.friend.coincidenceFriends.length/5,this.transparency>1&&(this.transparency=1)),this.style=`background-color: rgba(2, 254, 149, ${this.transparency})`}};const J=(0,o.Z)(G,[["render",V],["__scopeId","data-v-08245ed6"]]);var X=J,ee={name:"ListSearchedUser",data(){return{}},components:{FriendCart:X},computed:{...(0,b.Se)(["getFriendsDB"])},methods:{goToUserInfo(e){ae.push(`/user/${e}`)}}};const te=(0,o.Z)(ee,[["render",W],["__scopeId","data-v-04766352"]]);var re=te,se={name:"HomeView",components:{FormAddUser:C,ListSearchedUser:Z,ListChoosedUsers:L,FriendsList:re},computed:{...(0,b.Se)(["getSearchedUsers"]),isSearchedResults(){return this.getSearchedUsers.length>0}}};const ne=(0,o.Z)(se,[["render",m],["__scopeId","data-v-06f55cd0"]]);var ie=ne;const oe=[{path:"/",name:"HomeView",component:ie,meta:{keepAlive:!0}},{path:"/user/:payload",name:"UserInfoView",props:!0,component:()=>r.e(675).then(r.bind(r,6675))}],de=(0,u.p7)({history:(0,u.PO)("/"),routes:oe});var ae=de;const ce=r(4352),ue="40482a0e61f412e412e3eec730125d7bb7931bbf9b74b396eb3c78ab7595a628a5c197adac17a8f6d42c8";var le={state:{searchedUsers:[],choosedUsers:[],preparedUsers:[],friendsDB:[],queueTimeouts:[],sortedFriendsDB:[],wall:[]},getters:{getChoosedUsers(e){return e.choosedUsers},getSearchedUsers(e){return e.searchedUsers},getPreparedUsers(e){return e.preparedUsers},getUnsortedFriendsDB(e){return e.friendsDB},getQueueTimeouts(e){return e.queueTimeouts},getFriendsDB(e){if(e.sortedFriendsDB.length>0)return e.sortedFriendsDB;if(0===e.friendsDB.length)return[];let t=e.friendsDB.slice().filter((e=>"deleted"!=e.deactivated));t.sort(((e,t)=>{if(e.last_name>t.last_name)return 1;if(e.last_name===t.last_name){if(e.first_name>t.first_name)return 1;if(e.first_name<t.first_name)return-1}return e.last_name<t.last_name?-1:void 0}));for(let r=1;r<t.length;r++)t[r-1].coincidenceFriends||(t[r-1].coincidenceFriends=[],t[r-1].coincidenceFriends.push(t[r-1].ownerOfFriends)),t[r].id===t[r-1].id&&(t[r-1].coincidenceFriends.push(t[r].ownerOfFriends),t.splice(r,1),r--);for(let r=0;r<t.length;r++)t[r].positionForLatency=r;return e.sortedFriendsDB=t,e.sortedFriendsDB},getWall(e){return e.wall}},mutations:{updateSearchedUsers(e,t){e.searchedUsers=t},updateChoosedUsers(e,t){e.choosedUsers=t},updatePreparedUsers(e,t){e.preparedUsers=t},pushQueueTimeouts(e,t){e.queueTimeouts.push(t)},clearQueueTimeouts(e){for(let t of e.queueTimeouts)clearTimeout(t);e.queueTimeouts=[]},updateFriendsDB(e,t){e.friendsDB=t},updateSortedFriendsDB(e,t){e.sortedFriendsDB=t},updateWall(e,t){e.wall=t},setKnownCountOfFriends(e,t){e.sortedFriendsDB[t.position].knownCountOfFriends=t.countOfFriends},addUserToChoosed(e,t){for(let s of e.choosedUsers)if(s.id===t.id)return;t.isChoosed="no-choosed",e.choosedUsers.push(t);let r=e.searchedUsers.filter((e=>e.id!==t.id));e.searchedUsers=r,document.forms.addUser.ids.value="",e.searchedUsers=[]},addUserToPrepared(e,t){for(let r of e.preparedUsers)if(r.id===t.id){let s=e.preparedUsers.filter((e=>e.id!==r.id));return e.preparedUsers=s,void e.choosedUsers.map((e=>{e.id===t.id&&(e.isChoosed="no-choosed")}))}e.preparedUsers.push(t),e.choosedUsers.map((e=>{e.id===t.id&&(e.isChoosed="choosed")}))},removeCard(e,t){setTimeout((()=>{const r=e.choosedUsers.filter((e=>e.id!==t.id));e.choosedUsers=r;const s=e.preparedUsers.filter((e=>e.id!==t.id));e.preparedUsers=s}),50)}},actions:{async fetchSearchedUser(e,t){try{if(""===t)return void e.commit("updateSearchedUsers",[]);if(t.indexOf(",")>=0){const r=await ce(`https://api.vk.com/method/users.get?user_ids=${t}&fields=photo_50&access_token=${ue}&v=5.131`).promise;for(let e of r.response)e.isChoosed="no-choosed";return await e.commit("updateChoosedUsers",r.response),r.response}if("id"===t.slice(0,2)&&t.slice(2)==+t.slice(2)){let r=await ce(`https://api.vk.com/method/users.get?user_ids=${t.slice(2)}&fields=photo_50&access_token=${ue}&v=5.131`).promise;return r.response.isChoosed="no-choosed",await e.commit("updateSearchedUsers",r.response),r.response}{let r=await ce(`https://api.vk.com/method/users.search?q=${t}&count=5&fields=photo_50&access_token=${ue}&v=5.131`).promise;for(let e of r.response.items)e.isChoosed="no-choosed";return await e.commit("updateSearchedUsers",r.response.items),r.response.items}}catch(r){console.log(r)}},async fetchFriends(e,t){try{await e.commit("clearQueueTimeouts"),await e.commit("updateFriendsDB",[]),await e.commit("updateSortedFriendsDB",[]);let r=[];for(let e=0;e<t.length;e++){let s=await ce(`https://api.vk.com/method/friends.get?user_id=${t[e].id}&fields=bdate,sex&access_token=${ue}&v=5.131`).promise;if(s.error){console.log("профиль с id ",t[e].id," является приватным, список друзей получить нельзя");break}for(let n of s.response.items)n.ownerOfFriends=t[e].id,r.push(n)}await e.commit("updateFriendsDB",r)}catch(r){console.log(r)}},async fetchWall(e,t){try{let r=await ce(`https://api.vk.com/method/wall.get?owner_id=${t}&count=10&access_token=${ue}&v=5.131`).promise;await e.commit("updateWall",r.response.items)}catch(r){console.log(r)}}}},fe=(0,b.MT)({state:{},getters:{},mutations:{},actions:{},modules:{users:le}});(0,s.ri)(c).use(fe).use(ae).mount("#app")},6356:function(e,t,r){r.d(t,{Z:function(){return h}});var s=r(3396),n=r(7139);const i={class:"user-card__photo"},o=["src","alt"],d={class:"user-card__name"};function a(e,t,r,a,c,u){return(0,s.wg)(),(0,s.iD)("div",{class:(0,n.C_)(["user-card",r.user.isChoosed])},[(0,s._)("div",i,[(0,s._)("img",{src:r.user.photo_50,alt:r.user.last_name},null,8,o)]),(0,s._)("div",d,[(0,s._)("h3",null,(0,n.zw)(r.user.first_name)+" "+(0,n.zw)(r.user.last_name),1)]),r.addDeleteButton?((0,s.wg)(),(0,s.iD)("div",{key:0,class:"user-card__cross",onClick:t[0]||(t[0]=t=>e.removeCard(r.user))}," ✖ ")):(0,s.kq)("",!0)],2)}var c=r(65),u={name:"UserCard",data(){return{}},props:{user:Object,addDeleteButton:Boolean},methods:{...(0,c.OI)(["removeCard"])}},l=r(89);const f=(0,l.Z)(u,[["render",a],["__scopeId","data-v-4155cd7c"]]);var h=f}},t={};function r(s){var n=t[s];if(void 0!==n)return n.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,r),i.exports}r.m=e,function(){var e=[];r.O=function(t,s,n,i){if(!s){var o=1/0;for(u=0;u<e.length;u++){s=e[u][0],n=e[u][1],i=e[u][2];for(var d=!0,a=0;a<s.length;a++)(!1&i||o>=i)&&Object.keys(r.O).every((function(e){return r.O[e](s[a])}))?s.splice(a--,1):(d=!1,i<o&&(o=i));if(d){e.splice(u--,1);var c=n();void 0!==c&&(t=c)}}return t}i=i||0;for(var u=e.length;u>0&&e[u-1][2]>i;u--)e[u]=e[u-1];e[u]=[s,n,i]}}(),function(){r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,{a:t}),t}}(),function(){r.d=function(e,t){for(var s in t)r.o(t,s)&&!r.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){r.f={},r.e=function(e){return Promise.all(Object.keys(r.f).reduce((function(t,s){return r.f[s](e,t),t}),[]))}}(),function(){r.u=function(e){return"js/"+e+".7c8427d4.js"}}(),function(){r.miniCssF=function(e){return"css/"+e+".65c3da8e.css"}}(),function(){r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="vk-api:";r.l=function(s,n,i,o){if(e[s])e[s].push(n);else{var d,a;if(void 0!==i)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var l=c[u];if(l.getAttribute("src")==s||l.getAttribute("data-webpack")==t+i){d=l;break}}d||(a=!0,d=document.createElement("script"),d.charset="utf-8",d.timeout=120,r.nc&&d.setAttribute("nonce",r.nc),d.setAttribute("data-webpack",t+i),d.src=s),e[s]=[n];var f=function(t,r){d.onerror=d.onload=null,clearTimeout(h);var n=e[s];if(delete e[s],d.parentNode&&d.parentNode.removeChild(d),n&&n.forEach((function(e){return e(r)})),t)return t(r)},h=setTimeout(f.bind(null,void 0,{type:"timeout",target:d}),12e4);d.onerror=f.bind(null,d.onerror),d.onload=f.bind(null,d.onload),a&&document.head.appendChild(d)}}}(),function(){r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){r.p="/"}(),function(){var e=function(e,t,r,s){var n=document.createElement("link");n.rel="stylesheet",n.type="text/css";var i=function(i){if(n.onerror=n.onload=null,"load"===i.type)r();else{var o=i&&("load"===i.type?"missing":i.type),d=i&&i.target&&i.target.href||t,a=new Error("Loading CSS chunk "+e+" failed.\n("+d+")");a.code="CSS_CHUNK_LOAD_FAILED",a.type=o,a.request=d,n.parentNode.removeChild(n),s(a)}};return n.onerror=n.onload=i,n.href=t,document.head.appendChild(n),n},t=function(e,t){for(var r=document.getElementsByTagName("link"),s=0;s<r.length;s++){var n=r[s],i=n.getAttribute("data-href")||n.getAttribute("href");if("stylesheet"===n.rel&&(i===e||i===t))return n}var o=document.getElementsByTagName("style");for(s=0;s<o.length;s++){n=o[s],i=n.getAttribute("data-href");if(i===e||i===t)return n}},s=function(s){return new Promise((function(n,i){var o=r.miniCssF(s),d=r.p+o;if(t(o,d))return n();e(s,d,n,i)}))},n={143:0};r.f.miniCss=function(e,t){var r={675:1};n[e]?t.push(n[e]):0!==n[e]&&r[e]&&t.push(n[e]=s(e).then((function(){n[e]=0}),(function(t){throw delete n[e],t})))}}(),function(){var e={143:0};r.f.j=function(t,s){var n=r.o(e,t)?e[t]:void 0;if(0!==n)if(n)s.push(n[2]);else{var i=new Promise((function(r,s){n=e[t]=[r,s]}));s.push(n[2]=i);var o=r.p+r.u(t),d=new Error,a=function(s){if(r.o(e,t)&&(n=e[t],0!==n&&(e[t]=void 0),n)){var i=s&&("load"===s.type?"missing":s.type),o=s&&s.target&&s.target.src;d.message="Loading chunk "+t+" failed.\n("+i+": "+o+")",d.name="ChunkLoadError",d.type=i,d.request=o,n[1](d)}};r.l(o,a,"chunk-"+t,t)}},r.O.j=function(t){return 0===e[t]};var t=function(t,s){var n,i,o=s[0],d=s[1],a=s[2],c=0;if(o.some((function(t){return 0!==e[t]}))){for(n in d)r.o(d,n)&&(r.m[n]=d[n]);if(a)var u=a(r)}for(t&&t(s);c<o.length;c++)i=o[c],r.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return r.O(u)},s=self["webpackChunkvk_api"]=self["webpackChunkvk_api"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=r.O(void 0,[998],(function(){return r(8722)}));s=r.O(s)})();
//# sourceMappingURL=app.270fd21c.js.map